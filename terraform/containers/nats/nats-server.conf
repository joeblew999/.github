# NATS Server Configuration
server_name: "nats-cloudflare-container"

# Network configuration
host: "0.0.0.0"
port: 4222

# HTTP monitoring
http_port: 8222

# Clustering (for multi-container deployments)
cluster {
  name: "nats-cloudflare-cluster"
  host: "0.0.0.0"
  port: 6222
  
  # Dynamic routes configuration
  routes = [
    # Routes will be configured dynamically via Worker API
  ]
}

# Logging
log_file: "/var/log/nats/nats-server.log"
log_size_limit: 100MB
max_log_files: 5
debug: false
trace: false
logtime: true

# Connection limits
max_connections: 1000
max_subscriptions: 10000
max_pending: 67108864  # 64MB
max_payload: 1048576   # 1MB

# Authentication (configured via environment variables)
# authorization {
#   user: $NATS_USER
#   password: $NATS_PASSWORD
#   token: $NATS_AUTH_TOKEN
# }

# JetStream (if needed for persistence)
jetstream {
  enabled: true
  store_dir: "/data/nats"
  max_memory_store: 256MB
  max_file_store: 1GB
}

# TLS configuration (if using custom certificates)
# tls {
#   cert_file: "/etc/nats/tls/server.crt"
#   key_file: "/etc/nats/tls/server.key"
#   ca_file: "/etc/nats/tls/ca.crt"
#   verify: false
# }

# System account (for monitoring and management)
system_account: SYS

# Accounts configuration
accounts {
  SYS: {
    users: [
      { user: admin, password: $NATS_SYS_PASSWORD }
    ]
  }
  
  APP: {
    users: [
      { user: app, password: $NATS_APP_PASSWORD }
    ]
    jetstream: enabled
  }
}

# Default account
default_account: APP

# Monitoring and health checks
ping_interval: 30s
ping_max: 3
write_deadline: "10s"

# Memory and performance tuning
max_control_line: 4096
max_payload: 1048576
max_pending: 67108864

# Graceful shutdown
shutdown_timeout: "30s"
